<style>
  .container ul li.cc-visble:nth-of-type(3) {
    display: inline-block !important;
  }
  .products-featured .container .tab-title a:hover {
    cursor: pointer !important;
  }
  .tab-title.cc-active {
    color: #00a84f;
    box-shadow: inset 0 -4px 0 0 #00a84f;
  }
  $color: #b43938;
  $color2: #ffffff;
  $btn-height: 35px;
  #rand-id-recent {
    position: relative;
    z-index: 10000;
    width: 100%;
    height: 530px;
    transition: 0.5s;
    background-color: #fff;
    display: none;
    iframe {
      width: 100%;
      height: 100%;
    }
  }
  .tabs_item.SecTab {
    display: none;
  }
</style>
<cc-snippet append-to=".products-featured.section">
  <div class="tabs_item SecTab">
    <div id="rand-id-recent" class="cc-recentView">
    </div>
  </div>
</cc-snippet>
<cc-snippet name="slider">
  <style>
    @import url("https://fonts.googleapis.com/css?family=Roboto");
    * { box-sizing: border-box; }
    body, button, input {
      font-family: 'Roboto', sans-serif;
      font-size: 14px;
    }
    body {
      margin: 0;
      padding: 0;
      height: $slider-height;
      overflow: hidden;
    }
    .cc-slider-wrap {
      padding: 0 40px;
      max-width: 1236px;
      margin: auto;
      position: relative;
    }
    .cc-slider {
      overflow: hidden;
    }
    .cc-next, .cc-previous {
      cursor: pointer;
      position: absolute;
      z-index: 1;
      top: 105px;
      border: 1px solid #00a84f;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      svg {
        stroke: #00a84f;
        width: 15px;
      }
    }
    .cc-next {
      right: -12px;
      padding: 6px 12px;
    }
    .cc-previous {
      left: 0px;
      padding: 6px 10px;
      svg {
        transform: rotate(180deg);
      }
    }
    .cc-product {
      margin: 0 10px;
      max-height: 450px;
      height: 450px;
      width: 100%;
    }
    .cc-product-inner {
      position: relative;
      padding: 7%;
      overflow: hidden;
      background-color: #fff;
      border: 1px solid #bebebe;
      border-radius: 10px;
      box-shadow: 0 4px 3px -2px rgba(0, 0, 0, 0.5);
      margin-bottom: 0 !important;
      z-index: 1;
      transition: all 0.2s ease;
      margin-right: 10px;
      height: 280px;
    }
    .cc-product-inner:hover {
      box-shadow: 0 4px 3px -2px rgba(0, 0, 0, 0.5);
      -ms-transform: scale(1);
      transform: scale(1);
      border-color: #00a84f !important;
    }
    .cc-slider > div {
      margin: 0 auto;
    }
    .cc-product-image {
      text-align: center;
      display: block;
      z-index: 1;
      overflow: hidden;
      top: 50%;
      transform: translateY(-50%);
      position: relative;
      img {
        width: 250px;
      }
    }
    .cc-product-name {
      font-family: Lato, sans-serif, sans-serif;
      font-size: 20px;
      font-weight: 400;
      color: #303030;
      text-transform: none;
      text-decoration: none;
      height: 60px;
      cursor: pointer;
    }
    .cc-product-name:hover {
      color: #00a84f;
      transition: color 0.2s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    .cc-product-image img:hover {
      transition: all 0.2s ease;
      transform: scale(1.05);
    }
    .cc-btn-new {
      font-size: 0;
      width: 100%;
      display: block;
      vertical-align: top;
      padding: 0 15px 15px;
      margin: 25px 0;
      text-align: center;
    }
    .cc-product-price {
      font-size: 18px;
      color: #707070;
      text-transform: lowercase;
      margin-top: 25px;
      cursor: auto;
    }
    .cc-last-new {
      display: inline-block;
      width: 50%;
      text-align: right;
      vertical-align: middle;
      a {
        font-size: 13px;
        color: #fff;
        background: #72c168;
        background: -webkit-linear-gradient(top, #72c168, #b4d88b);
        filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#72c168", endColorstr="#b4d88b", GradientType=0);
        zoom: 1;
        background-clip: padding-box;
        padding: 10px 7px;
        display: block;
        text-align: center;
        border-radius: 50px;
        font-weight: 600;
        text-decoration: none;
      }
    }
    @media only screen and (min-width: 1226px) and (max-width: 1348px) {
      .cc-slider-wrap {
        max-width: 1160px;
      }
      .cc-product-image img {
        width: 210px;
      }
      .cc-product-inner {
        height: 250px;
      }
    }
    @media only screen and (min-width: 1079px) and (max-width: 1225px) {
      .cc-slider-wrap {
        max-width: 985px;
      }
      .cc-product-image img {
        width: 170px;
      }
      .cc-product-name {
        font-size: 13px;
        padding: 20px 10px 0;
      }
      .cc-product-inner {
        height: 230px;
      }
      .cc-last-new {
        a {
          font-size: 11px;
        }
      }
      .cc-product-price {
        font-size: 18px;
      }
    }
    @media only screen and (min-width: 899px) and (max-width: 1079px) {
      .cc-slider-wrap {
        max-width: 940px;
      }
      .cc-product-image img {
        width: 170px;
      }
      .cc-product-name {
        font-size: 13px;
        padding: 20px 10px 0;
      }
      .cc-last-new {
        a {
          font-size: 11px;
        }
      }
      .cc-product-price {
        font-size: 18px;
      }
    }
  </style>
  <div class="cc-slider-wrap">
    <div class="cc-next">
      <svg class="cc-arrow" viewBox="0 0 6.3 10.6">
        <path d="M.6.5l4.7 4.8L.6 10" fill="none" stroke-width="1.3"/>
      </svg>
    </div>
    <div class="cc-previous">
      <svg class="cc-arrow" viewBox="0 0 6.3 10.6">
        <path d="M.6.5l4.7 4.8L.6 10" fill="none" stroke-width="1.3"/>
      </svg>
    </div>
    <div class="cc-slider">
    </div>
  </div>
</cc-snippet>
<cc-snippet name="product">
  <div class="cc-product">
    <div class="cc-product-inner">
      <a class="cc-product-image" target="_blank" href="#">
        <img />
      </a>
    </div>
      <div class="cc-btn-new">
        <div class="cc-product-name" target="_blank" href="#">
          <img />
        </div>
        <div class="cc-product-price"></div>
      </div>
  </div>
</cc-snippet>
<cc-snippet name="iframe">
  <iframe data-cc-src="slider" frameborder="0" ></iframe>
</cc-snippet>
<script wait-for = "footer">
  const Siema = require('siema');
  const $ = require('zepto');
  const { ctx, randId, snippets } = campaign;
  let iframeInserted = false;
  let products;
  const jrecent = $(`#${randId}recent`);
  let opened = false;
  $('.products-featured.section .container ul').append('<li class="tab-title"><a>Recently Viewed</a></li>');
  $('.container ul.tabs li.tab-title:nth-child(1)').addClass('cc-active');
  $('.container ul li:nth-child(1) a').removeAttr('href');
  $('.products-featured .container ul li:nth-child(3)').on('click', () => {
    $('#featured-products').hide();
    $('.tabs_item.SecTab').show();
    // $('.tabs li.tab-title').first().removeClass('cc-active');
    campaign.trigger('Clicked.recentlyviewed');
    opened = !opened;
    jrecent.toggleClass('cc-opened', opened);
    if (!iframeInserted) {
      iframeInserted = true;
      campaign.insertHTML('append-to', `#${randId}recent`, snippets.iframe)
        .then(() => {
          const jif = jrecent.find('iframe').contents();
          const jslider = jif.find('.cc-slider');
          const jnext = jif.find('.cc-next');
          const jprev = jif.find('.cc-previous');
          products.forEach((prod) => {
            const jp = $(snippets.product);
            jp.find('.cc-product-image').attr('href', prod.url).find('img').attr('src', prod.image);
            jp.find('.cc-product-name').text(prod.name).attr('href', prod.url);
            jp.find('.cc-learnBtn').attr('href', prod.url);
            jp.find('.cc-product-price').text(`$${(prod.price || 0).toFixed(2)}`);
            jp.appendTo(jslider);
          });
          setTimeout(function () {
            const slider = new Siema({
              selector: jslider.get(0),
              perPage: {
                320: 1,
                480: 4,
                768: 3,
                992: 4,
                loop: true,
              },
            });
            if (products.length < 0) {
              $('.tab-title.cc-recent a').show();
              $('.container ul li:nth-child(3)').css('display', 'inline-block');
              // $('.container ul li').first().addClass('cc-active');
            } else {
              $('.tab-title.cc-recent a').hide();
            }
            jif.find('.cc-product').on('click', () => campaign.trigger('Clicked.product'));
            jif.find('.cc-next').on('click', () => slider.next());
            jif.find('.cc-previous').on('click', () => slider.prev());
            if (products.length > 4) {
              if (slider.currentSlide + slider.perPage == slider.perPage) {
                jprev.hide();
              }
              if (products.length == slider.currentSlide + slider.perPage) {
                jnext.hide();
              }
            } else {
              jprev.hide();
              jnext.hide();
            }
            jnext.on('click', () => {
              slider.next();
              slider.next();
              slider.next();
              if (products.length > 4) {
                jprev.show();
                if (products.length == slider.currentSlide + slider.perPage) {
                  jnext.hide();
                } else {
                  jnext.show();
                }
              }
            });
            jprev.on('click', () => {
              slider.prev();
              slider.prev();
              slider.prev();
              if (products.length > 4) {
                jnext.show();
                if (slider.currentSlide + slider.perPage == slider.perPage) {
                  jprev.hide();
                } else {
                  jprev.show();
                }
              }
            });
          }, 100);
        });
    }
  });
  ctx.ccart('get', 'productsViewed', (iproducts) => {
    products = (iproducts || []).slice(-8);
    jrecent.toggle(!!products.length);
    if (products.length > 0) {
      // $('.container ul li').eq(0).addClass('cc-active');
      $('.tabs li.tab-title').last().addClass('cc-visble');
      if ($('.container ul li:nth-of-type(3).cc-active').length) {
        $('.tab-title:nth-of-type(1)').removeClass('cc-active');
      }
      $('.container ul li').each(function () {
        // $(this).eq(0).addClass('cc-active');
        $(this).on('click', function () {
          $('li.cc-active').removeClass('cc-active');
          $(this).addClass('cc-active');
        });
      });
    } else {
      $('.tabs li.tab-title').last().removeClass('cc-visble');
      $('.tabs li.tab-title').first().removeClass('cc-active');
    }
  });
  $('.container ul li:nth-child(1)').on('click', () => {
    $('#featured-products').show();
    $('.tabs_item.SecTab').hide();
  });
  /*  $('.tab-title:nth-of-type(3)').on('click', () => {
    $('.tab-title:nth-of-type(1)').removeClass('cc-active');
  });
  $('.tab-title:nth-of-type(1)').on('click', () => {
    $('.tab-title:nth-of-type(3)').removeClass('cc-active');
  }); */
</script>
